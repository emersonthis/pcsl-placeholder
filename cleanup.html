<!DOCTYPE html>
<html>
  <head>
    <title>Portland Squash</title>
    <script>
      async function checkAndRemoveServiceWorker() {
        if (!("serviceWorker" in navigator)) {
          // If service workers aren't supported, go straight to main page
          window.location.href = "main.html";
          return;
        }

        try {
          // Get all service workers
          const registrations =
            await navigator.serviceWorker.getRegistrations();

          // If no service workers, go straight to main page
          if (registrations.length === 0) {
            window.location.href = "main.html";
            return;
          }

          // Check for Vue service worker
          let hasVueServiceWorker = false;
          for (let registration of registrations) {
            if (
              registration.scope.includes("service-worker.js") ||
              registration.active.scriptURL.includes("service-worker.js")
            ) {
              hasVueServiceWorker = true;
              await registration.unregister();
              console.log("Vue service worker unregistered");
            }
          }

          // If we found and removed a Vue service worker, also clear caches
          if (hasVueServiceWorker && "caches" in window) {
            const cacheKeys = await caches.keys();
            for (let cacheName of cacheKeys) {
              if (
                cacheName.includes("precache") ||
                cacheName.includes("runtime") ||
                cacheName.includes("app")
              ) {
                await caches.delete(cacheName);
                console.log("Deleted cache:", cacheName);
              }
            }
            // Only force reload if we actually removed something
            window.location.reload(true);
          } else {
            // If no Vue service worker found, go straight to main page
            window.location.href = "main.html";
          }
        } catch (error) {
          console.error("Error checking service worker:", error);
          // On error, safely redirect to main page
          window.location.href = "main.html";
        }
      }

      // Run the check when page loads
      window.addEventListener("load", checkAndRemoveServiceWorker);
    </script>
  </head>
  <body>
    <div style="font-family: sans-serif; padding: 20px; text-align: center">
      <p>Checking site data...</p>
      <p>You will be redirected automatically.</p>
    </div>
  </body>
</html>
